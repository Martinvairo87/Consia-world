<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="color-scheme" content="dark" />
  <title>CONSIA</title>

  <!-- PWA -->
  <link rel="manifest" href="/app.webmanifest" />
  <link rel="icon" href="/public/assets/icon-192.png" />
  <link rel="apple-touch-icon" href="/public/assets/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Social -->
  <meta property="og:title" content="CONSIA" />
  <meta property="og:description" content="CONSIA CORE — Owner-Only. Privacy-First. Infinite." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.45);
      --glass:rgba(255,255,255,.06);
      --glass2:rgba(255,255,255,.10);
      --line:rgba(255,255,255,.14);
      --shadow: 0 20px 80px rgba(0,0,0,.65);
      --radius: 22px;
      --radius2: 28px;
      --pad: clamp(14px, 2.2vw, 22px);
      --max: 1120px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% 20%, rgba(255,255,255,.08), transparent 55%),
                  radial-gradient(900px 600px at 10% 70%, rgba(255,255,255,.06), transparent 55%),
                  radial-gradient(900px 600px at 90% 75%, rgba(255,255,255,.05), transparent 55%),
                  #000;
      color:var(--fg);
      font-family:var(--sans);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    button{ font-family:inherit; }

    /* Subtle moving grain */
    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      opacity:.13;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      animation: drift 14s linear infinite;
    }
    @keyframes drift{
      0%{ transform:translate3d(0,0,0); }
      100%{ transform:translate3d(-10%, -10%, 0); }
    }

    /* Top bar */
    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(0,0,0,.78), rgba(0,0,0,.35));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .nav{
      max-width:var(--max);
      margin:0 auto;
      padding: 14px var(--pad);
      display:flex; align-items:center; justify-content:space-between;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      letter-spacing:.34em;
      text-transform:uppercase;
      font-weight:600;
      font-size:13px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(255,255,255,.92);
      box-shadow:0 0 28px rgba(255,255,255,.35);
    }
    .nav-right{
      display:flex; align-items:center; gap:10px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px;
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size:12px;
      color:var(--muted);
    }
    .pill b{ color:var(--fg); font-weight:600; }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:var(--fg);
      padding:10px 14px;
      border-radius:999px;
      font-size:12px;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
      transition:.18s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn:hover{ transform:translateY(-1px); border-color:rgba(255,255,255,.32); background: rgba(255,255,255,.09); }
    .btn:active{ transform:translateY(0); }

    /* Hero */
    main{ position:relative; z-index:10; }
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding: clamp(26px, 4vw, 56px) var(--pad) 90px;
    }

    .hero{
      margin-top: clamp(18px, 2vw, 30px);
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap: clamp(16px, 2vw, 24px);
      align-items:stretch;
    }
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
    }

    .panel{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(900px 380px at 30% 20%, rgba(255,255,255,.14), transparent 55%);
      opacity:.7;
      pointer-events:none;
    }

    .panel-inner{ position:relative; padding: clamp(18px, 2.4vw, 28px); }
    .kicker{
      display:flex; align-items:center; gap:10px;
      font-family:var(--mono);
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .kline{
      height:1px; flex:1;
      background: linear-gradient(to right, rgba(255,255,255,.22), transparent);
    }
    h1{
      margin: 14px 0 10px;
      font-size: clamp(34px, 4.2vw, 58px);
      letter-spacing: .18em;
      text-transform:uppercase;
      line-height:1.03;
      font-weight:650;
    }
    .sub{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: clamp(14px, 1.35vw, 16px);
      line-height:1.6;
      max-width: 58ch;
    }
    .cta-row{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top: 16px;
    }
    .cta{
      flex:0 0 auto;
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 16px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color:var(--fg);
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      cursor:pointer;
      transition:.18s ease;
    }
    .cta.primary{
      background: rgba(255,255,255,.92);
      color:#000;
      border-color: rgba(255,255,255,.92);
    }
    .cta:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.34); }
    .cta.primary:hover{ filter:brightness(.98); }
    .cta:active{ transform: translateY(0); }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .card{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding: 14px 14px;
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px;
      transition:.18s ease;
    }
    .card:hover{ border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .card h3{
      margin:0;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:650;
    }
    .card p{
      margin:8px 0 0;
      color: var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .tag{
      font-family:var(--mono);
      font-size:11px;
      color: var(--muted2);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      padding:8px 10px;
      white-space:nowrap;
      background: rgba(0,0,0,.25);
    }

    /* Terminal */
    .term{
      margin-top: 12px;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top: 14px;
      font-family:var(--mono);
      font-size:12px;
      color: rgba(255,255,255,.78);
      line-height:1.6;
    }
    .term .row{ display:flex; gap:10px; align-items:flex-start; }
    .prompt{ color: rgba(255,255,255,.55); }
    .mono{ font-family:var(--mono); }

    /* Footer */
    footer{
      border-top:1px solid rgba(255,255,255,.10);
      padding: 18px var(--pad);
      color: var(--muted2);
      font-size:12px;
    }
    .foot{
      max-width:var(--max);
      margin:0 auto;
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; flex-wrap:wrap;
    }
    .links{ display:flex; gap:14px; flex-wrap:wrap; }
    .links a{ color: var(--muted); }
    .links a:hover{ color: var(--fg); }

    /* Toast */
    .toast{
      position:fixed;
      left:50%; bottom:22px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 999px;
      padding: 12px 14px;
      color: rgba(255,255,255,.85);
      font-size:12px;
      display:none;
      align-items:center;
      gap:10px;
      z-index:60;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .toast.show{ display:flex; }
    .toast .ok{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.92);
      box-shadow:0 0 22px rgba(255,255,255,.35);
    }
  </style>
</head>

<body>
  <div class="grain"></div>

  <header>
    <div class="nav">
      <div class="brand" aria-label="CONSIA">
        <span class="dot" aria-hidden="true"></span>
        <span>CONSIA</span>
      </div>

      <div class="nav-right">
        <div class="pill" id="statusPill">
          <span class="mono">API</span>
          <b id="apiStatus">CHECK</b>
          <span class="mono" id="apiPing">—</span>
        </div>

        <button class="btn" id="installBtn" style="display:none;">Instalar</button>
        <button class="btn" id="copyCmdBtn">Comando “.”</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="hero">
        <!-- Left: Hero -->
        <div class="panel">
          <div class="panel-inner">
            <div class="kicker">
              <span class="mono">OWNER-ONLY • PRIVACY-FIRST</span>
              <span class="kline"></span>
              <span class="mono" id="timeNow">—</span>
            </div>

            <h1>CONSIA CORE</h1>
            <p class="sub">
              Sistema operativo vivo para decisiones, voz, avatar y comercio global.
              Minimal friction. Fail-closed. Self-healing. Sin vueltas.
            </p>

            <div class="cta-row">
              <a class="cta primary" href="/voice.html">Entrar a Voice</a>
              <a class="cta" href="/owner.html">Owner Dashboard</a>
              <a class="cta" href="/marketplace.html">Marketplace</a>
              <a class="cta" href="/live.html">Live</a>
              <button class="cta" id="wakeBtn">Wake (demo)</button>
            </div>

            <div class="term" aria-label="CONSIA Terminal">
              <div class="row"><span class="prompt">consia@core</span><span>›</span><span id="termLine1">inicializando…</span></div>
              <div class="row"><span class="prompt">consia@core</span><span>›</span><span id="termLine2">verificando seguridad…</span></div>
              <div class="row"><span class="prompt">consia@core</span><span>›</span><span id="termLine3">listo.</span></div>
              <div class="row" style="margin-top:10px;">
                <span class="prompt">TIP</span><span>›</span>
                <span>En iPhone: <b>Compartir → “Add to Home Screen”</b> para modo app.</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Cards -->
        <div class="panel">
          <div class="panel-inner">
            <div class="kicker">
              <span class="mono">MÓDULOS</span>
              <span class="kline"></span>
              <span class="mono">v1</span>
            </div>

            <div class="grid" style="margin-top:14px;">
              <a class="card" href="/voice.html">
                <div>
                  <h3>VOICE + AVATAR</h3>
                  <p>STT/TTS + control por comandos. Modo demo wake.</p>
                </div>
                <span class="tag">/voice.html</span>
              </a>

              <a class="card" href="/owner.html">
                <div>
                  <h3>OWNER-ONLY</h3>
                  <p>Panel de control + lock biométrico (cuando habilites WebAuthn).</p>
                </div>
                <span class="tag">/owner.html</span>
              </a>

              <a class="card" href="/marketplace.html">
                <div>
                  <h3>MARKETPLACE</h3>
                  <p>Catálogo + checkout. Pasarela live se habilita al conectar Stripe/Paddle.</p>
                </div>
                <span class="tag">/marketplace.html</span>
              </a>

              <a class="card" href="/api/health">
                <div>
                  <h3>API HEALTH</h3>
                  <p>Chequeo directo desde Pages (proxy functions).</p>
                </div>
                <span class="tag">/api/health</span>
              </a>
            </div>

            <div class="term">
              <div class="row"><span class="prompt">ENDPOINT</span><span>›</span><span class="mono" id="apiBase">/api</span></div>
              <div class="row"><span class="prompt">POLICY</span><span>›</span><span>fail-closed, owner-only, privacy-first</span></div>
              <div class="row"><span class="prompt">STATE</span><span>›</span><span id="stateLine">sync…</span></div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="foot">
      <div>© <span id="y"></span> CONSIA • Infinite Core</div>
      <div class="links">
        <a href="/pricing.html">Pricing</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/refund.html">Refund</a>
      </div>
    </div>
  </footer>

  <div class="toast" id="toast"><span class="ok"></span><span id="toastMsg">Copiado.</span></div>

  <script>
    // ===== CONFIG =====
    const API = "/api"; // via Pages Functions (correct)
    const HEALTH = API + "/health";

    // ===== TIME =====
    const timeEl = document.getElementById("timeNow");
    function tick(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      timeEl.textContent = `${hh}:${mm}`;
    }
    tick(); setInterval(tick, 10000);

    // ===== YEAR =====
    document.getElementById("y").textContent = String(new Date().getFullYear());

    // ===== TOAST =====
    const toast = document.getElementById("toast");
    const toastMsg = document.getElementById("toastMsg");
    let toastT = null;
    function showToast(msg){
      toastMsg.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastT);
      toastT = setTimeout(()=>toast.classList.remove("show"), 1600);
    }

    // ===== COPY COMMAND "." =====
    document.getElementById("copyCmdBtn").addEventListener("click", async () => {
      const cmd = ".";
      try{
        await navigator.clipboard.writeText(cmd);
        showToast('Comando "." copiado');
      }catch(e){
        showToast("No se pudo copiar (iOS)");
      }
    });

    // ===== API HEALTH CHECK =====
    const apiStatus = document.getElementById("apiStatus");
    const apiPing = document.getElementById("apiPing");
    const term1 = document.getElementById("termLine1");
    const term2 = document.getElementById("termLine2");
    const term3 = document.getElementById("termLine3");
    const stateLine = document.getElementById("stateLine");

    async function healthCheck(){
      const t0 = performance.now();
      apiStatus.textContent = "CHECK";
      apiPing.textContent = "—";
      try{
        const res = await fetch(HEALTH, { cache: "no-store" });
        const ms = Math.round(performance.now() - t0);
        apiPing.textContent = ms + "ms";
        if(!res.ok){
          apiStatus.textContent = "DOWN";
          term1.textContent = "api health: down";
          term2.textContent = "modo seguro (read-only)";
          term3.textContent = "reintenta en 10s…";
          stateLine.textContent = "LOCK (api down)";
          return;
        }
        const data = await res.json().catch(()=>({}));
        apiStatus.textContent = "OK";
        term1.textContent = "api health: ok";
        term2.textContent = "security: fail-closed ✅";
        term3.textContent = "ready.";
        if(data && typeof data === "object"){
          const binds = data.bindings ? Object.keys(data.bindings).filter(k=>data.bindings[k]).join(", ") : "—";
          stateLine.textContent = "Bindings: " + binds;
        }else{
          stateLine.textContent = "Bindings: —";
        }
      }catch(e){
        apiStatus.textContent = "DOWN";
        apiPing.textContent = "—";
        term1.textContent = "api health: error";
        term2.textContent = "modo seguro (read-only)";
        term3.textContent = "reintenta en 10s…";
        stateLine.textContent = "LOCK (network)";
      }
    }
    healthCheck();
    setInterval(healthCheck, 10000);

    // ===== INSTALL PWA (best effort) =====
    let deferredPrompt = null;
    const installBtn = document.getElementById("installBtn");
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = "inline-flex";
    });
    installBtn.addEventListener("click", async () => {
      if(!deferredPrompt){
        showToast("En iPhone: Compartir → Add to Home Screen");
        return;
      }
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice.catch(()=>null);
      deferredPrompt = null;
      installBtn.style.display = "none";
      showToast(choice?.outcome === "accepted" ? "Instalando…" : "Cancelado");
    });

    // ===== Service Worker =====
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    }

    // ===== WAKE (DEMO) =====
    // Nota: iOS Safari no deja wake word real siempre-on (por políticas).
    // Esto es demo por interacción del usuario (tap).
    const wakeBtn = document.getElementById("wakeBtn");
    wakeBtn.addEventListener("click", async () => {
      showToast("Wake demo: escuchando…");
      // Si existe voice.html, redirigimos con un flag para auto-start
      setTimeout(()=>{ window.location.href = "/voice.html?autostart=1"; }, 650);
    });
  </script>
</body>
</html>
