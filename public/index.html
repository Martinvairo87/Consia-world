<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>CONSIA CORE</title>

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family:Arial;
}

/* STATUS */
#status{
  position:absolute;
  bottom:40px;
  width:100%;
  text-align:center;
  color:white;
  letter-spacing:6px;
  font-size:22px;
  opacity:0.7;
}

/* WAKE GLOW */
#wakeGlow{
  position:absolute;
  width:300px;
  height:300px;
  border-radius:50%;
  background:radial-gradient(circle,#00ffff,transparent);
  filter:blur(60px);
  opacity:0;
  transition:0.2s;
}
</style>
</head>

<body>

<div id="wakeGlow"></div>
<div id="status">CONSIA CORE ACTIVE</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>

// SCENE
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  60,
  innerWidth/innerHeight,
  0.1,
  1000
);
camera.position.z = 4;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// ORB
const geo = new THREE.SphereGeometry(1,64,64);
const mat = new THREE.MeshBasicMaterial({
  color:0x00ffff,
  wireframe:true
});
const orb = new THREE.Mesh(geo,mat);
scene.add(orb);

// PARTICLES
const pGeo = new THREE.BufferGeometry();
const pCount = 500;
const positions = new Float32Array(pCount*3);

for(let i=0;i<pCount*3;i++){
  positions[i]=(Math.random()-0.5)*10;
}

pGeo.setAttribute(
  'position',
  new THREE.BufferAttribute(positions,3)
);

const pMat = new THREE.PointsMaterial({
  color:0x00ffff,
  size:0.02
});

const particles = new THREE.Points(pGeo,pMat);
scene.add(particles);

// LIGHT
const light = new THREE.PointLight(0x00ffff,2);
scene.add(light);

// MOUSE EYE TRACK
document.addEventListener("mousemove",e=>{
  const x=(e.clientX/innerWidth-0.5)*2;
  const y=(e.clientY/innerHeight-0.5)*2;

  orb.rotation.y = x;
  orb.rotation.x = y;

  document.getElementById("wakeGlow").style.left =
    e.clientX-150+"px";

  document.getElementById("wakeGlow").style.top =
    e.clientY-150+"px";
});

// AUDIO LIP SYNC
navigator.mediaDevices.getUserMedia({audio:true})
.then(stream=>{

  const ctx = new AudioContext();
  const src = ctx.createMediaStreamSource(stream);
  const analyser = ctx.createAnalyser();

  src.connect(analyser);

  const data = new Uint8Array(analyser.frequencyBinCount);

  function audioLoop(){
    analyser.getByteFrequencyData(data);

    let volume=0;
    for(let i=0;i<data.length;i++){
      volume+=data[i];
    }
    volume/=data.length;

    // ORB PULSE
    const scale=1+volume/300;
    orb.scale.set(scale,scale,scale);

    // PARTICLES REACT
    particles.rotation.y+=volume/50000;

    // WAKE GLOW
    document.getElementById("wakeGlow").style.opacity =
      volume>20 ? 1 : 0;

    // EMOTION COLOR
    if(volume>80){
      mat.color.set(0xff00ff);
    }else if(volume>40){
      mat.color.set(0x00ffff);
    }else{
      mat.color.set(0x0044ff);
    }

    requestAnimationFrame(audioLoop);
  }

  audioLoop();
});

// WEBSOCKET STREAM READY
const socket = new WebSocket(
  "wss://api.consia.world/ws/core"
);

socket.onopen=()=>{
  console.log("CONSIA STREAM ACTIVE");
};

// ANIMATE
function animate(){
  requestAnimationFrame(animate);

  orb.rotation.y+=0.002;
  particles.rotation.y+=0.0005;

  renderer.render(scene,camera);
}
animate();

</script>

</body>
</html>
