<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>CONSIA LIVE</title>

<style>
/* ===================== THEME ===================== */
:root{
  --bg:#000;
  --panel:#0b0b0b;
  --glass:rgba(10,10,10,.78);
  --line:rgba(255,255,255,.14);
  --text:#fff;
  --muted:rgba(255,255,255,.75);
  --muted2:rgba(255,255,255,.55);
  --good:#3ddc84;
  --warn:#ffcc00;
  --bad:#ff4d4d;
  --shadow:0 18px 44px rgba(0,0,0,.55);
  --r:16px;
  --r2:22px;
}

/* ===================== RESET ===================== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
  overflow:hidden;
}

/* ===================== TOP BAR ===================== */
#topbar{
  position:fixed; inset:0 0 auto 0; height:64px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:10px 14px;
  background:linear-gradient(180deg, rgba(0,0,0,.9), rgba(0,0,0,.35));
  border-bottom:1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(10px);
  z-index:50;
}
#brand{display:flex; flex-direction:column}
#brand .t{font-weight:800; letter-spacing:.4px}
#brand .s{font-size:12px; color:var(--muted)}
#status{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.pill{
  display:inline-flex; gap:8px; align-items:center;
  padding:8px 10px; border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid var(--line);
  font-size:12px; color:var(--muted);
}
.dot{width:8px;height:8px;border-radius:50%}
.good{background:var(--good)}
.warn{background:var(--warn)}
.bad{background:var(--bad)}

/* ===================== STAGE ===================== */
#stage{position:absolute; inset:64px 0 0 0}
#remoteVideo{
  width:100%; height:100%; object-fit:cover; background:#000;
}

/* ===================== WAITING OVERLAY ===================== */
#overlay{
  position:absolute; inset:64px 0 0 0;
  display:flex; align-items:center; justify-content:center;
  padding:22px; pointer-events:none; z-index:10;
}
#overlayCard{
  width:min(520px,92vw);
  background:var(--glass);
  border:1px solid var(--line);
  border-radius:var(--r2);
  padding:18px;
  box-shadow:var(--shadow);
  backdrop-filter: blur(14px);
}
#overlayCard h3{margin:0 0 6px 0}
#overlayCard p{margin:0; font-size:13px; color:var(--muted); line-height:1.35}
#overlayBadge{
  margin-top:12px; display:inline-flex; gap:8px; align-items:center;
  padding:8px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid var(--line);
  font-size:12px; color:var(--muted);
}

/* ===================== PIP (SELF VIEW) ===================== */
#pip{
  position:absolute; right:16px; bottom:16px;
  width:160px; height:220px;
  border-radius:var(--r);
  background:#111; border:1px solid var(--line);
  box-shadow:0 12px 30px rgba(0,0,0,.6);
  overflow:hidden; z-index:20;
}
#localVideo{
  width:100%; height:100%; object-fit:cover;
  transform:scaleX(-1); background:#0a0a0a;
}
#pipBadges{
  position:absolute; left:10px; bottom:10px;
  display:flex; gap:8px; align-items:center;
  padding:6px 8px; border-radius:999px;
  background:rgba(0,0,0,.55); border:1px solid var(--line);
  font-size:12px;
}

/* ===================== CONTROLS ===================== */
#controls{
  position:fixed; left:12px; right:12px; bottom:12px;
  display:flex; gap:8px; flex-wrap:wrap; justify-content:center; z-index:60;
}
.btn{
  border:none; cursor:pointer; border-radius:999px;
  padding:12px 14px; font-weight:700; font-size:13px; color:#fff;
  background:rgba(255,255,255,.08); border:1px solid var(--line);
  backdrop-filter: blur(10px);
}
.btn.primary{background:rgba(61,220,132,.16); border-color:rgba(61,220,132,.35)}
.btn.danger{background:rgba(255,77,77,.16); border-color:rgba(255,77,77,.35)}
.btn.ghost{background:rgba(255,255,255,.06)}
.btn:disabled{opacity:.45; cursor:not-allowed}

/* ===================== CHAT ===================== */
#chat{
  position:fixed; top:76px; right:12px;
  width:min(360px,calc(100vw - 24px));
  height:min(62vh,520px);
  background:var(--glass); border:1px solid var(--line);
  border-radius:18px; box-shadow:var(--shadow);
  backdrop-filter: blur(14px);
  display:none; z-index:55; overflow:hidden;
}
#chat header{
  padding:12px; border-bottom:1px solid rgba(255,255,255,.10);
  display:flex; justify-content:space-between; align-items:center;
}
#chat header .t{font-weight:800}
#chat header .s{font-size:12px; color:var(--muted)}
#chat main{padding:12px; height:calc(100% - 122px); overflow:auto}
.msg{
  background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10);
  border-radius:14px; padding:10px; margin-bottom:10px;
}
.msg .o{font-size:11px; color:var(--muted2)}
.msg .t{margin-top:6px; font-size:13px}
.msg .tr{margin-top:6px; font-size:12px; color:rgba(255,255,255,.8)}
#chat footer{padding:10px; border-top:1px solid rgba(255,255,255,.10)}
#chat input{
  width:100%; padding:10px; border-radius:14px;
  background:rgba(0,0,0,.35); border:1px solid var(--line); color:#fff;
}

/* ===================== CAPTIONS ===================== */
#captions{
  position:fixed; left:12px; right:12px; bottom:78px;
  display:none; justify-content:center; z-index:40; pointer-events:none;
}
#captionsBox{
  width:min(860px,96vw); padding:10px 12px;
  background:rgba(0,0,0,.62); border:1px solid var(--line);
  border-radius:16px; text-align:center; box-shadow:var(--shadow);
}

/* ===================== AVATAR GUIDE ===================== */
#avatar{
  position:fixed; left:14px; bottom:14px;
  display:flex; align-items:center; gap:10px; z-index:70;
}
#avatarBtn{
  width:44px; height:44px; border-radius:50%;
  background:rgba(255,255,255,.08); border:1px solid var(--line);
  box-shadow:var(--shadow); cursor:pointer;
}
#avatarCard{
  display:none; max-width:320px;
  background:var(--glass); border:1px solid var(--line);
  border-radius:16px; padding:12px;
  box-shadow:var(--shadow); backdrop-filter: blur(14px);
}
#avatarCard p{margin:0; font-size:13px; color:var(--muted); line-height:1.35}

/* ===================== SMALL ===================== */
@media(max-width:420px){
  #pip{width:132px;height:184px; right:12px; bottom:12px}
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div id="topbar">
  <div id="brand">
    <div class="t">CONSIA ‚Äî LIVE</div>
    <div class="s">Presencia real ¬∑ Sin grabaciones</div>
  </div>
  <div id="status">
    <div class="pill"><span class="dot warn" id="dotLive"></span><span id="txtLive">LIVE: off</span></div>
    <div class="pill"><span class="dot warn" id="dotMedia"></span><span id="txtMedia">MEDIA: standby</span></div>
    <div class="pill"><span class="dot warn" id="dotPeer"></span><span id="txtPeer">PEER: esperando</span></div>
  </div>
</div>

<!-- STAGE -->
<div id="stage">
  <video id="remoteVideo" autoplay playsinline></video>

  <div id="overlay">
    <div id="overlayCard">
      <h3>Estamos preparando el LIVE</h3>
      <p>El host a√∫n no inici√≥ la sesi√≥n. Tu c√°mara y micr√≥fono est√°n apagados.</p>
      <div id="overlayBadge">üîí Modo soberano activo ‚Äî nada se graba, nada se guarda.</div>
    </div>
  </div>

  <div id="pip">
    <video id="localVideo" autoplay playsinline muted></video>
    <div id="pipBadges">
      <span id="bCam">üé• OFF</span>
      <span id="bMic">üéôÔ∏è OFF</span>
    </div>
  </div>
</div>

<!-- CONTROLS -->
<div id="controls">
  <button class="btn" id="btnMedia">Activar c√°mara + audio</button>
  <button class="btn primary" id="btnStart">Iniciar LIVE (host)</button>
  <button class="btn ghost" id="btnChat">Chat</button>
  <button class="btn ghost" id="btnTrans">Traducci√≥n</button>
  <button class="btn danger" id="btnEnd">Finalizar LIVE</button>
</div>

<!-- CHAT -->
<section id="chat">
  <header>
    <div>
      <div class="t">Chat en vivo</div>
      <div class="s">Ef√≠mero ¬∑ no se guarda</div>
    </div>
    <button class="btn ghost" onclick="toggleChat(false)">‚úï</button>
  </header>
  <main id="chatBody"></main>
  <footer>
    <input id="chatInput" placeholder="Escrib√≠ algo relevante para este momento‚Ä¶"/>
  </footer>
</section>

<!-- CAPTIONS -->
<div id="captions"><div id="captionsBox">Subt√≠tulos en tiempo real ¬∑ ef√≠meros</div></div>

<!-- AVATAR -->
<div id="avatar">
  <button id="avatarBtn">ü§ñ</button>
  <div id="avatarCard"><p id="avatarTxt"></p></div>
</div>

<script>
/* ===================== STATE ===================== */
let localStream=null, liveOn=false, peerOn=false, transOn=false;
const $=id=>document.getElementById(id);

/* ===================== HELPERS ===================== */
function setDot(id,cls){$(id).className='dot '+cls}
function show(el, v){el.style.display=v?'':'none'}
function updateBadges(){
  const camOn = localStream?.getVideoTracks()?.some(t=>t.enabled);
  const micOn = localStream?.getAudioTracks()?.some(t=>t.enabled);
  $('bCam').textContent = camOn?'üé• ON':'üé• OFF';
  $('bMic').textContent = micOn?'üéôÔ∏è ON':'üéôÔ∏è OFF';
  setDot('dotMedia', camOn||micOn?'good':'warn');
  $('txtMedia').textContent = camOn||micOn?'MEDIA: on':'MEDIA: standby';
}
function avatarSay(txt,autoHide=true){
  $('avatarTxt').textContent=txt;
  show($('avatarCard'),true);
  if(autoHide) setTimeout(()=>show($('avatarCard'),false),4000);
}

/* ===================== MEDIA ===================== */
async function startMedia(){
  if(localStream) return;
  localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  $('localVideo').srcObject = localStream;
  updateBadges();
  avatarSay("Activ√° el LIVE cuando est√©s listo. Nada se graba.");
}

/* ===================== LIVE ===================== */
function startLive(){
  liveOn=true; peerOn=true;
  setDot('dotLive','good'); $('txtLive').textContent='LIVE: on';
  setDot('dotPeer','good'); $('txtPeer').textContent='PEER: conectado';
  show($('overlay'),false);
  avatarSay("El invitado te ver√° cuando inicies el LIVE.");
}
function endLive(){
  liveOn=false; peerOn=false;
  setDot('dotLive','warn'); $('txtLive').textContent='LIVE: off';
  setDot('dotPeer','warn'); $('txtPeer').textContent='PEER: esperando';
  show($('overlay'),true);
  // hard stop
  localStream?.getTracks().forEach(t=>t.stop());
  localStream=null;
  $('localVideo').srcObject=null;
  updateBadges();
  show($('captions'),false);
  avatarSay("LIVE finalizado. Todo se apag√≥ autom√°ticamente.");
}

/* ===================== CHAT ===================== */
function toggleChat(v){show($('chat'),v)}
$('chatInput').addEventListener('keydown',e=>{
  if(e.key==='Enter' && liveOn){
    const d=document.createElement('div');
    d.className='msg';
    d.innerHTML=`<div class="o">vos ¬∑ ahora</div><div class="t">${e.target.value}</div>`+
                (transOn?`<div class="tr">[traducci√≥n]</div>`:'');
    $('chatBody').appendChild(d);
    e.target.value='';
    $('chatBody').scrollTop=1e9;
  }
});

/* ===================== TRANSLATION (UI ONLY) ===================== */
function toggleTrans(){
  transOn=!transOn;
  show($('captions'),transOn && liveOn);
  avatarSay(transOn?
    "Traducci√≥n activada. Subt√≠tulos ef√≠meros en tiempo real.":
    "Traducci√≥n desactivada."
  );
}

/* ===================== EVENTS ===================== */
$('btnMedia').onclick=startMedia;
$('btnStart').onclick=startLive;
$('btnEnd').onclick=endLive;
$('btnChat').onclick=()=>toggleChat(true);
$('btnTrans').onclick=toggleTrans;
$('avatarBtn').onclick=()=>toggleChat(false)||show($('avatarCard'),!$('avatarCard').style.display);

/* Safety: close tab */
window.addEventListener('pagehide',()=>liveOn&&endLive());
document.addEventListener('visibilitychange',()=>{
  if(document.hidden && liveOn) avatarSay("Est√°s en segundo plano. Al cerrar, todo se apaga.",false);
});

/* First time onboarding */
setTimeout(()=>avatarSay("Bienvenido. Activ√° tu c√°mara cuando quieras. Esto no se guarda."),800);
</script>

</body>
</html>
